openapi: 3.1.0
info:
  title: ARG LNB FastAPI
  description: API REST para datos de jugadores de la Liga Nacional de Básquet (LNB) de Argentina. Lee automáticamente un CSV público y expone datos con paginación, filtros y agrupación.
  version: 1.0.0
  contact:
    name: Sports Analytics World
    url: https://github.com/sportsanalytics-world/arg-lnb-fastapi
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://arg-lnb-fastapi.onrender.com
    description: Production server

paths:
  /:
    get:
      summary: Información de la API
      description: Endpoint raíz con información sobre la API
      operationId: getRoot
      responses:
        '200':
          description: Información de la API
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "API CSV desde Google Drive"
                  version:
                    type: string
                    example: "1.0.0"

  /datos:
    get:
      summary: Obtener datos del CSV
      description: Obtiene datos con paginación, filtros y agrupación. Usar limit para controlar resultados.
      operationId: getDatos
      parameters:
        - name: page
          in: query
          description: Número de página (empezando en 1)
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: limit
          in: query
          description: Número de registros por página (máximo 100)
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
            example: 20
        - name: team
          in: query
          description: Filtrar por equipo
          required: false
          schema:
            type: string
            example: "Boca Juniors"
        - name: season
          in: query
          description: Filtrar por temporada
          required: false
          schema:
            type: integer
            enum: [2020, 2021, 2022, 2023, 2024]
            example: 2023
        - name: position
          in: query
          description: Filtrar por posición
          required: false
          schema:
            type: string
            enum: ["G", "F", "C", "PG", "SG", "SF", "PF", "-"]
            example: "F"
        - name: nationality
          in: query
          description: Filtrar por nacionalidad
          required: false
          schema:
            type: string
            example: "Argentina"
        - name: first_name
          in: query
          description: Filtrar por nombre ajustado del jugador
          required: false
          schema:
            type: string
            example: "Pablo"
        - name: last_name
          in: query
          description: Filtrar por apellido ajustado del jugador
          required: false
          schema:
            type: string
            example: "Aaron"
        - name: birthdate
          in: query
          description: Filtrar por fecha de nacimiento (YYYY-MM-DD)
          required: false
          schema:
            type: string
            example: "2000-01-27"
        - name: height
          in: query
          description: Filtrar por altura en centímetros
          required: false
          schema:
            type: number
            example: 190.0
        - name: weight
          in: query
          description: Filtrar por peso en kilogramos
          required: false
          schema:
            type: number
            example: 85.0
        - name: group_by
          in: query
          description: Agrupar por player, team, season, o career
          required: false
          schema:
            type: string
            enum: ["player", "team", "season", "career"]
            example: "player"
        - name: include_stats
          in: query
          description: Incluir estadísticas en la respuesta
          required: false
          schema:
            type: boolean
            default: false
            example: true
      responses:
        '200':
          description: Datos del CSV
          content:
            application/json:
              schema:
                oneOf:
                  - type: array
                    items:
                      $ref: '#/components/schemas/Player'
                  - type: array
                    items:
                      $ref: '#/components/schemas/GroupedPlayer'
                  - type: array
                    items:
                      $ref: '#/components/schemas/GroupedTeam'
                  - type: array
                    items:
                      $ref: '#/components/schemas/GroupedSeason'
                  - type: array
                    items:
                      $ref: '#/components/schemas/GroupedCareer'
                  - $ref: '#/components/schemas/DataWithStats'
              examples:
                normal_response:
                  summary: Respuesta normal
                  value:
                    - firstName: "Pablo"
                      lastName: "Aaron"
                      adjustedFirstName: "Pablo"
                      adjustedLastName: "Aaron"
                      team: "Boca Juniors"
                      season: 2020
                      position: "F"
                      height: 198.0
                      weight: null
                      nationality: "Argentina"
                      birthdate: "2000-01-27"
                stats_response:
                  summary: Respuesta con estadísticas
                  value:
                    data:
                      - nombreAjustado: "Juan Pablo"
                        apellidoAjustado: "Cantero"
                        equipos: ["Union SF", "Comunicaciones Mercedes"]
                        temporadas: [2023]
                        posiciones: ["PG", "C"]
                        altura: 182.0
                        peso: 83.0
                        nacionalidad: "Argentina"
                        fechaNacimiento: "1982-09-19"
                    stats:
                      totalRecords: 15
                      totalPages: 5
                      currentPage: 1
                      recordsPerPage: 3
                      dataStats:
                        uniquePlayers: 15
                        uniqueTeams: 14
                        uniqueSeasons: 5
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /info:
    get:
      summary: Información sobre los datos
      description: Información sobre datos disponibles, filtros y paginación
      operationId: getInfo
      responses:
        '200':
          description: Información sobre los datos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Info'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /health:
    get:
      summary: Verificación de salud
      description: Estado de salud de la API
      operationId: getHealth
      responses:
        '200':
          description: Estado de salud
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  message:
                    type: string
                    example: "API funcionando correctamente"

components:
  schemas:
    Player:
      type: object
      description: Información de un jugador
      properties:
        firstName:
          type: string
          description: Nombre del jugador
          example: "Pablo"
        lastName:
          type: string
          description: Apellido del jugador
          example: "Aaron"
        adjustedFirstName:
          type: string
          description: Nombre ajustado del jugador
          example: "Pablo"
        adjustedLastName:
          type: string
          description: Apellido ajustado del jugador
          example: "Aaron"
        team:
          type: string
          description: Equipo del jugador
          example: "Boca Juniors"
        season:
          type: integer
          description: Temporada
          example: 2020
        position:
          type: string
          description: Posición del jugador
          enum: ["G", "F", "C", "PG", "SG", "SF", "PF", "-"]
          example: "F"
        height:
          type: number
          description: Altura en centímetros
          example: 198.0
        weight:
          type: number
          nullable: true
          description: Peso en kilogramos
          example: 85.0
        nationality:
          type: string
          description: Nacionalidad del jugador
          example: "Argentina"
        birthdate:
          type: string
          description: Fecha de nacimiento
          example: "2000-01-27"

    DataWithStats:
      type: object
      description: Respuesta con datos y estadísticas
      properties:
        data:
          type: array
          items:
            oneOf:
              - $ref: '#/components/schemas/Player'
              - $ref: '#/components/schemas/GroupedPlayer'
              - $ref: '#/components/schemas/GroupedTeam'
              - $ref: '#/components/schemas/GroupedSeason'
        stats:
          $ref: '#/components/schemas/Stats'

    GroupedPlayer:
      type: object
      description: Jugador agrupado (cuando group_by=player)
      properties:
        nombreAjustado:
          type: string
          example: "Juan Pablo"
        apellidoAjustado:
          type: string
          example: "Cantero"
        equipos:
          type: array
          items:
            type: string
          example: ["Union SF", "Comunicaciones Mercedes"]
        temporadas:
          type: array
          items:
            type: integer
          example: [2023]
        posiciones:
          type: array
          items:
            type: string
          example: ["PG", "C"]
        altura:
          type: number
          example: 182.0
        peso:
          type: number
          nullable: true
          example: 83.0
        nacionalidad:
          type: string
          example: "Argentina"
        fechaNacimiento:
          type: string
          example: "1982-09-19"

    GroupedTeam:
      type: object
      description: Equipo agrupado (cuando group_by=team)
      properties:
        equipo:
          type: string
          example: "Boca Juniors"
        totalJugadores:
          type: integer
          example: 18
        temporadas:
          type: array
          items:
            type: integer
          example: [2023]
        posiciones:
          type: array
          items:
            type: string
          example: ["C"]
        nacionalidades:
          type: array
          items:
            type: string
          example: ["Argentina"]

    GroupedSeason:
      type: object
      description: Temporada agrupada (cuando group_by=season)
      properties:
        temporada:
          type: integer
          example: 2023
        totalJugadores:
          type: integer
          example: 376
        equipos:
          type: array
          items:
            type: string
          example: ["Boca Juniors", "Quimsa"]
        posiciones:
          type: array
          items:
            type: string
          example: ["G", "F", "C"]
        nacionalidades:
          type: array
          items:
            type: string
          example: ["Argentina", "United States"]

    GroupedCareer:
      type: object
      description: Trayectoria completa del jugador (cuando group_by=career)
      properties:
        nombre:
          type: string
          example: "Pablo"
        apellido:
          type: string
          example: "Aaron"
        nombreAjustado:
          type: string
          example: "Pablo"
        apellidoAjustado:
          type: string
          example: "Aaron"
        trayectoria:
          type: array
          items:
            type: object
            properties:
              temporada:
                type: integer
                example: 2023
              equipos:
                type: array
                items:
                  type: string
                example: ["Boca Juniors", "Quimsa"]
        posiciones:
          type: array
          items:
            type: string
          example: ["F", "C"]
        altura:
          type: number
          nullable: true
          example: 198.0
        peso:
          type: number
          nullable: true
          example: 85.0
        nacionalidad:
          type: string
          example: "Argentina"
        fechaNacimiento:
          type: string
          example: "2000-01-27"
        totalTemporadas:
          type: integer
          example: 3
        totalEquipos:
          type: integer
          example: 2

    Stats:
      type: object
      description: Estadísticas de la respuesta
      properties:
        totalRecords:
          type: integer
          example: 376
        totalPages:
          type: integer
          example: 19
        currentPage:
          type: integer
          example: 1
        recordsPerPage:
          type: integer
          example: 20
        filtersApplied:
          type: object
          properties:
            team:
              type: string
            season:
              type: integer
            position:
              type: string
            nationality:
              type: string
            firstName:
              type: string
            lastName:
              type: string
            birthdate:
              type: string
            height:
              type: number
            weight:
              type: number
        dataStats:
          type: object
          properties:
            uniquePlayers:
              type: integer
              example: 376
            uniqueTeams:
              type: integer
              example: 20
            uniqueSeasons:
              type: integer
              example: 1

    Info:
      type: object
      description: Información sobre los datos disponibles
      properties:
        totalRecords:
          type: integer
          example: 1914
        totalColumns:
          type: integer
          example: 12
        teams:
          type: array
          items:
            type: string
          example: ["Boca Juniors", "Quimsa"]
        seasons:
          type: array
          items:
            type: integer
          example: [2020, 2021, 2022, 2023, 2024]
        positions:
          type: array
          items:
            type: string
          example: ["G", "F", "C", "PG", "SG", "SF", "PF"]
        nationalities:
          type: array
          items:
            type: string
          example: ["Argentina", "United States", "Brazil"]

    Error:
      type: object
      description: Error de la API
      properties:
        detail:
          type: string
          example: "Error al leer el archivo CSV"

tags:
  - name: Data
    description: Endpoints relacionados con los datos del CSV
  - name: System
    description: Endpoints del sistema y salud 